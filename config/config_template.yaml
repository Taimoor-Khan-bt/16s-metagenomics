# =============================================================================
# config/config.yaml — User configuration for the QIIME 2 Snakemake pipeline
# =============================================================================
# Edit this file for each study. All paths may be absolute or relative to the
# project root (the directory where you run snakemake).

# ── Docker ──────────────────────────────────────────────────────────────────
docker:
  image: "quay.io/qiime2/amplicon:2024.10"
  # Pull with: docker pull quay.io/qiime2/amplicon:2024.10

# ── Input / Output ───────────────────────────────────────────────────────────
samples:       "config/samples.tsv"        # sample_id | r1 | r2 (one sample per row)
metadata_file: "config/metadata.tsv"       # QIIME 2 metadata (#SampleID header)
classifier: "refs/silva-138-99-nb-classifier.qza"
output_dir: "output/qiime2_run"         # all artifacts + QZVs written here

# ── DADA2 denoising (Paired-End) ─────────────────────────────────────────────
dada2:
  trunc_len_f: 220     # truncate forward reads at this position (bp); 0 = no truncation
  trunc_len_r: 220     # truncate reverse reads at this position
  trim_left_f: 0       # trim N bases from the forward 5' end
  trim_left_r: 0       # trim N bases from the reverse 5' end
  threads: 0         # 0 = use all available cores

# ── Diversity ────────────────────────────────────────────────────────────────
diversity:
  sampling_depth: 'auto'    # 'auto' or 0 = auto-detect minimum read count to avoid dropping samples
  alpha_metrics:
    - faith_pd
    - shannon
    - evenness
    - observed_features
  beta_metrics:
    - unweighted_unifrac
    - weighted_unifrac
    - bray_curtis
    - jaccard

# ── Metadata ──────────────────────────────────────────────────────────────────
metadata:
  group_column: "Stunting"   # column for alpha/beta group significance tests
                             # must have ≥2 samples per category

# ── Extended analysis strategy ───────────────────────────────────────────────
analysis:
  group_column: "Stunting"           # primary comparison variable
  
  # ── Confounders / Covariates ───────────────────────────────────────────────
  # These variables are included in the GLM (Alpha diversity) and 
  # PERMANOVA / adonis2 (Beta diversity) models to adjust for confounding.
  # Ensure these exact names match your metadata column headers!
  covariates:
    - "Agemons"             # Age
    - "Sex"                 # Gender
    - "Caries_Severity"     # DMFT Category (or use DMFT_Score)
    # - "Toothbrush_Use"    # Add this column to your metadata first!
  
  # Taxonomy levels: 2=Phylum, 3=Class, 6=Genus (SILVA)
  collapse_levels:
    - "2"   # phylum
    - "3"   # class
    - "6"   # genus
  ancombc_levels:
    - "2"   # phylum differential abundance
    - "6"   # genus differential abundance
    
  # Formula passed to ANCOM-BC for differential abundance testing.
  # The formula MUST include your primary group_column plus confounders.
  ancombc_formula: "Stunting + Agemons + Sex + Caries_Severity"
  
  core_prevalence: 0.5                            # fraction of samples to define core

# ── PICRUSt2 ─────────────────────────────────────────────────────────────────
picrust:
  env: "picrust2"        # conda env name with PICRUSt2 installed
  # Install: mamba create -n picrust2 -c conda-forge -c bioconda picrust2 -y
